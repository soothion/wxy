define(["jquery"],function(e){var n=1,t=(new Date).getTime(),o={user:JSON.parse(window.sessionStorage.getItem("user")||window.localStorage.getItem("user"))||{},accessToken:window.localStorage.getItem("accessToken")||"",refreshToken:window.localStorage.getItem("refreshToken")||""},i=function(e){var n=window.location.hash||window.location.search,t=n.substring(1);if(t){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),i=t.match(o);return null!=i?decodeURI(i[2]):null}return null},r=function(){return window.location.hash.split("?")[0]||""},a=function(n){return e(function(){n.init&&n.init()}),n},s=function(n){var t=e("#showTip"),o=e("body");t.html()?(t.find("div").html(n),t.show()):(o.append('<div class="tip-show" id="showTip"><div>'+n+"</div></div>"),t=e("#showTip")),setTimeout(function(){t.hide()},2e3)},c=function(){var n=e("#loadingDiv"),t=location.toString().substring(0,location.toString().indexOf("module/"))+"/css/images/ajaxloader.gif";if(0===n.length){var o=e("body");o.append('<div id="loadingDiv"><div><img src="'+t+'"><p>努力加载中...</p></div></div>');var n=e("#loadingDiv")}return n.show(),!0},u=function(){e("#loadingDiv").hide()},d=function(){var n=e("#coverBg"),t=e("body");n.html()?n.show():(t.append('<div id="coverBg" class="cover-bg"></div>'),n=e("#coverBg"),n.show())},l=function(){e("#coverBg").hide()},g=function(e){for(var n=0,t=0;t<e.length;t++)e.charAt(t).match(/[\u0391-\uFFE5]/)?n+=2:n++;return n},f=function(e){var n=e;if(!n)return null;try{n=n.replace(/\r\n/g,"<br>"),n=n.replace(/\n/g,"<br>")}catch(t){B(t.message)}return n},p=function(){var e=navigator.userAgent.toLowerCase();return"micromessenger"==e.match(/MicroMessenger/i)?!0:!1},h=function(n,t){var o=[],i=e("#swiper-containerWrap"),n=n,r=e("body");o.push('<div class="swiper-container full" id="swiper-container"><div class="swiper-wrapper" id="fullSwiper">');for(var a=0,s=n.length;s>a;a++){var c=n[a].img||n[a].image.url;o.push('<div class="swiper-slide"><img  src="'+c+'" onerror="this.src=\'../../images/default_img.png\'" index = "'+a),o.push('" class="swiper-lazy" /></div>')}o.push('</div><div class="swiper-pagination"></div></div>'),r.find("#swiper-containerWrap").html()||r.append(i),i.html(o.join("")),i.show();var u={autoplay:!1,pagination:".swiper-pagination",paginationClickable:!0,preloadImages:!0,lazyLoading:!1,lazyLoadingInPrevNext:!0,initialSlide:0};e.extend(u,t||{});var d=new Swiper("#swiper-container",u);return i.on("click",function(){i.hide()}),d},m=function(){e("img").error(function(){e(this).attr("src","../../images/default_img.png")})},v=function(){e("body").append('<a href="javascript:void(0)" class="totop_btn" id="gotop"></a>');var n=e("#gotop");window.onscroll=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;e>=250?n.show():n.hide()},n.on("click",function(){e("html,body").animate({scrollTop:0},500)})},w=function(){var n=e(".ticketno"),t="";n.each(function(n,o){var i=e(this);t=i.text(),t=t.substring(0,4)+"&nbsp;"+t.substring(4,8),i.html(t)})},k=function(n){function t(e){var n=new Image;n.onload=function(){s++,o()},n.onerror=function(){s++,o()},n.src=e}function o(){i(),s==a&&r.onFinish()}function i(){r.onProgress(parseFloat(s/a))}var r={data:[],onFinish:function(){},onProgress:function(e){}};r=e.extend(r,n||{});for(var a=r.data.length,s=0,c=0;a>c;c++)t(r.data[c])},b=function(n){function t(n){var t,o=n.substring(n.lastIndexOf(".")+1);/^(png|jpg|jpeg|gif)$/.test(o)?(t=new Image,t.src=n,t.onerror=t.onload=function(){a()}):e.get(n,function(){a(),"css"===o&&e("head").append('<link rel="stylesheet" type="text/css" href="'+n+'">')})}var o={fileList:[],onFinish:function(){},processor:function(e){}};o=e.extend(o,n||{});var i=o.fileList.length,r=i;o.fileList.forEach(function(e,n){t(e)});var a=function(){o.processor(1- --i/r),0==i&&o.onFinish()}},S=function(n){var t=this,o=null,i={data:{ver:"5.3",time:parseInt((new Date).getTime()/1e3),from:window.navigator.userAgent+"#type=WECHAT#os="+window.navigator.userAgent+"#dpi="+e(window).width()+"x"+e(window).height(),seq:t.randomString(),body:{userId:""}},url:apiConfig.userApi,successCallback:null,method:"post",dataType:"json",async:!0,completeCallback:null,showLoading:!0};return e.extend(!0,i,n),i.showLoading&&t.showLoading(),e.ajax({type:i.method,url:i.url,data:{code:JSON.stringify(i.data)},async:i.async,dataType:i.dataType,success:function(e){return i.successCallback?(i.successCallback(e),void(i.showLoading&&t.hideLoading())):(o=e,void(i.showLoading&&t.hideLoading()))},complete:function(){i.completeCallback&&i.completeCallback()},error:function(e,n){i.showLoading&&t.hideLoading();var o="";switch(n){case"parsererror":o="响应数据格式异常!";break;case"timeout":o="请求超时，请稍后再试!";break;case"offline":o="网络异常，请稍后再试!";break;default:o="数据请求失败，请稍后再试!"}t.showTip(o)}}),o},y=function(i){setting={data:{userId:o.user.userId},url:apiConfig.userApi,successCallback:null,method:"post",dataType:"json",async:!0,completeCallback:null,showLoading:!0},e.extend(!0,setting,i),setting.data=JSON.stringify(setting.data);var r=window.navigator.userAgent,a="bundle=FQA5WK2BN43YRM8Z&version=6.0&device-type=WECHAT&device-dpi="+window.screen.width+"x"+window.screen.height+"&device-model=&device-network=&device-uuid="+(window.localStorage.getItem("device-uuid")?window.localStorage.getItem("device-uuid"):I())+"&device-cpu=&device-os="+r+"&timestamp="+(new Date).getTime()+"&sequence="+t+n++ +"&access-token="+o.accessToken;a+="&sign="+e.md5(a+"&request="+setting.data),a=a.replace(/device-os=([^&]*)(&|$)/,"device-os="+encodeURIComponent(r)+"&"),-1!=setting.url.indexOf("?")?setting.url+="&"+a:setting.url+="?"+a,setting.showLoading&&c(),e.ajax({type:setting.method,url:setting.url,data:{request:setting.data},async:setting.async,dataType:setting.dataType,timeout:15e3,success:function(e){"10689"==e.code||"10609"==e.code?(o.requestArgs=i,y({url:apiConfig.newApi+"getAccessTokenByRefreshToken.html",data:{userId:o.user.userId,refreshToken:o.refreshToken},successCallback:function(e){var n=e.response.accessToken;n&&(o.accessToken=n,o.requestArgs.data.accessToken=n,window.localStorage.setItem("accessToken",n),y(o.requestArgs))}})):"10614"==e.code?C():"11016"==e.code?B(e.message,function(){window.location.toString().indexOf("userLogin.html")<0&&window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html"}):setting.successCallback&&setting.successCallback(e),setting.showLoading&&u()},complete:function(){setting.completeCallback&&setting.completeCallback()},error:function(e,n){setting.showLoading&&u();var t="";switch(n){case"parsererror":t="响应数据格式异常!";break;case"timeout":B("网络故障，访问不了臭美服务器，请确认是否可以上网");break;case"offline":t="网络异常，请稍后再试!";break;default:t="数据请求失败，请稍后再试!"}s(t)}})},T=function(){return o.user&&o.accessToken?o.user:(C(),null)},C=function(){p()?F()||(window.location=apiConfig.newApi+"user/get-userInfo-h5.html?h5_redirect_url="+location.toString().replace(/\?/,"QQQ").replace(/=/,"ZZZ").replace(/&/,"XXX")):(window.location.toString().indexOf("userLogin.html")<0&&window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html")},x=function(){var e=this,n=window.localStorage.getItem("addrlati"),t=window.localStorage.getItem("addrlong");if(!n&&!t)if(window.navigator.geolocation){e.showLoading();var o={enableHighAccuracy:!0,timeout:7e3};window.navigator.geolocation.getCurrentPosition(function(o){var i=o.coords;t=i.longitude,n=i.latitude;var r=new BMap.Point(t,n);BMap.Convertor.translate(r,0,function(){t=r.lng,n=r.lat,window.localStorage.setItem("addrlong",t),window.localStorage.setItem("addrlati",n),e.hideLoading()})},function(n){e.hideLoading(),e.alert("我们为您准备了更好的推荐服务，请允许微信访问地理位置信息\n您可以在“设置”中允许微信访问位置信息。")},o)}else e.alert("浏览器不支持html5来获取地理位置信息")},I=function(e){e=e||32;for(var n="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=n.length,o=[],i=0;e>i;i++)o.push(n.charAt(Math.floor(Math.random()*t)));return o.join("")},L=function(e){var n=/^1\d{10}$/;return n.test(e)},A=function(n,t,o){var i=e(".confirm"),r=e("body");if(!(i.length>0)){e.isFunction(t)&&(o=t,t=null),t=e.extend({},t,{cancelButtonText:t&&t.cancelButtonText||"取消",okButtonText:t&&t.okButtonText||"确定",message:n||""});var a=[];a.push('<div class="confirm">'),a.push('<div class="confirm">'),a.push('<div class="confirm-mask"></div>'),a.push('<div class="confirm-div">'),a.push('<div class="confirm-div-top">'),a.push("<p>"+t.message+"</p>"),a.push("</div>"),a.push('<div class="confirm-div-bottom">'),a.push('<span id ="confirm_cancel_button">'+t.cancelButtonText+"</span>"),a.push('<span id ="confirm_ok_button">'+t.okButtonText+"</span>"),a.push("</div>"),a.push("</div>"),a.push("</div>"),r.append(a.join("")),i=e(".confirm"),i.fadeIn("fast");var s=e("#confirm_cancel_button"),c=e("#confirm_ok_button");s.on("click",function(e){e.stopPropagation(),u(),o&&o(!1)}),c.on("click",function(e){e.stopPropagation(),u(),o&&o(!0)});var u=function(){i.fadeOut("fast"),i.remove(),c.off(),s.off()}}},B=function(n,t,o){var i,r=e("body"),a=e(".alert");if(!(a.length>0)){e.isFunction(t)&&(o=t,t=null),t=e.extend({},t,{okButtonText:t&&t.okButtonText||"确定",message:n||""});var s=[];s.push('<div class="alert">'),s.push('<div class="alert-mask"></div>'),s.push('<div class="alert-div">'),s.push('<div class="alert-div-top"><p>'+t.message+"</p></div>"),s.push('<div class="alert-div-bottom"><p>'+t.okButtonText+"</p></div>"),s.push("</div>"),s.push("</div>"),r.append(s.join("")),a=e(".alert"),i=e(".alert-div-bottom > p"),i.on("click",function(e){e.stopPropagation(),a.fadeOut("fast"),a.remove(),i.off(),o&&o()}),a.fadeIn("fast")}},_=function(e){this.require({fileList:["../../utils/module/aes.js"],onFinish:function(){GibberishAES.size(256),e&&e()}})},j=function(e,n,t){this._loadAES(function(){t(GibberishAES.aesEncrypt(e,n?n:e).toString().replace(/\n/g,""))})},O=function(e,n,t){this._loadAES(function(){t(GibberishAES.aesDecrypt(e,n?n:e).toString().replace(/\n/g,""))})},E=function(n,t){e.isFunction(arguments[0])?(t=arguments[0],n=".header"):n?"":n=".header",e(n).append('<span class="back" id="back"></span>'),t||(t=function(){history.go(-1)}),e("#back").on("click",t)},q=function(n){e.isFunction(arguments[0])?(cb=arguments[0],n=".header"):n?"":n=".header",e(n).append('<span id="menu" class="menu"></span>');var t='<div class="menu-wrap" id="menuWrap"><ul class="menu-ul"><li><a href="../home/homePage.html" target="_parent">首页</a></li><li><a href="../user/myPage.html" target="_parent">我的</a></li></ul><div class="mask"></div></div>';e("body").append(t),e("#menu,.menu-wrap").on("click",function(n){e("#menuWrap").toggle()}),e(".mask").on("touchstart",function(n){e("#menuWrap").toggle(),n.preventDefault(),n.stopPropagation()}),e(".mask").on("touchmove",function(e){e.preventDefault(),e.stopPropagation()})},F=function(){var e=i("userInfo");return null!==e?(e||(window.location.toString().indexOf("userLogin.html")<0&&window.sessionStorage.setItem("location",window.location),window.location="../user/userLogin.html"),user=JSON.parse(e),o.user=user,o.accessToken=user.accessToken,o.refreshToken=user.refreshToken,window.localStorage.setItem("accessToken",user.accessToken),window.localStorage.setItem("refreshToken",user.refreshToken),window.sessionStorage.setItem("user",JSON.stringify(user)),window.localStorage.setItem("user",JSON.stringify(user)),!0):!1};return F(),Array.prototype.indexOf||(Array.prototype.indexOf=function(e){for(var n=0;n<this.length;n++)if(this[n]==e)return n;return-1}),window.localStorage.getItem("device-uuid")||window.localStorage.setItem("device-uuid",I()),function(e){var n=function(e,n){return e<<n|e>>>32-n},t=function(e,n){var t,o,i,r,a;return i=2147483648&e,r=2147483648&n,t=1073741824&e,o=1073741824&n,a=(1073741823&e)+(1073741823&n),t&o?2147483648^a^i^r:t|o?1073741824&a?3221225472^a^i^r:1073741824^a^i^r:a^i^r},o=function(e,n,t){return e&n|~e&t},i=function(e,n,t){return e&t|n&~t},r=function(e,n,t){return e^n^t},a=function(e,n,t){return n^(e|~t)},s=function(e,i,r,a,s,c,u){return e=t(e,t(t(o(i,r,a),s),u)),t(n(e,c),i)},c=function(e,o,r,a,s,c,u){return e=t(e,t(t(i(o,r,a),s),u)),t(n(e,c),o)},u=function(e,o,i,a,s,c,u){return e=t(e,t(t(r(o,i,a),s),u)),t(n(e,c),o)},d=function(e,o,i,r,s,c,u){return e=t(e,t(t(a(o,i,r),s),u)),t(n(e,c),o)},l=function(e){for(var n,t=e.length,o=t+8,i=(o-o%64)/64,r=16*(i+1),a=Array(r-1),s=0,c=0;t>c;)n=(c-c%4)/4,s=c%4*8,a[n]=a[n]|e.charCodeAt(c)<<s,c++;return n=(c-c%4)/4,s=c%4*8,a[n]=a[n]|128<<s,a[r-2]=t<<3,a[r-1]=t>>>29,a},g=function(e){var n,t,o="",i="";for(t=0;3>=t;t++)n=e>>>8*t&255,i="0"+n.toString(16),o+=i.substr(i.length-2,2);return o},f=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var n="",t=0;t<e.length;t++){var o=e.charCodeAt(t);128>o?n+=String.fromCharCode(o):o>127&&2048>o?(n+=String.fromCharCode(o>>6|192),n+=String.fromCharCode(63&o|128)):(n+=String.fromCharCode(o>>12|224),n+=String.fromCharCode(o>>6&63|128),n+=String.fromCharCode(63&o|128))}return n};e.extend({md5:function(e){var n,o,i,r,a,p,h,m,v,w=Array(),k=7,b=12,S=17,y=22,T=5,C=9,x=14,I=20,L=4,A=11,B=16,_=23,j=6,O=10,E=15,q=21;for(e=f(e),w=l(e),p=1732584193,h=4023233417,m=2562383102,v=271733878,n=0;n<w.length;n+=16)o=p,i=h,r=m,a=v,p=s(p,h,m,v,w[n+0],k,3614090360),v=s(v,p,h,m,w[n+1],b,3905402710),m=s(m,v,p,h,w[n+2],S,606105819),h=s(h,m,v,p,w[n+3],y,3250441966),p=s(p,h,m,v,w[n+4],k,4118548399),v=s(v,p,h,m,w[n+5],b,1200080426),m=s(m,v,p,h,w[n+6],S,2821735955),h=s(h,m,v,p,w[n+7],y,4249261313),p=s(p,h,m,v,w[n+8],k,1770035416),v=s(v,p,h,m,w[n+9],b,2336552879),m=s(m,v,p,h,w[n+10],S,4294925233),h=s(h,m,v,p,w[n+11],y,2304563134),p=s(p,h,m,v,w[n+12],k,1804603682),v=s(v,p,h,m,w[n+13],b,4254626195),m=s(m,v,p,h,w[n+14],S,2792965006),h=s(h,m,v,p,w[n+15],y,1236535329),p=c(p,h,m,v,w[n+1],T,4129170786),v=c(v,p,h,m,w[n+6],C,3225465664),m=c(m,v,p,h,w[n+11],x,643717713),h=c(h,m,v,p,w[n+0],I,3921069994),p=c(p,h,m,v,w[n+5],T,3593408605),v=c(v,p,h,m,w[n+10],C,38016083),m=c(m,v,p,h,w[n+15],x,3634488961),h=c(h,m,v,p,w[n+4],I,3889429448),p=c(p,h,m,v,w[n+9],T,568446438),v=c(v,p,h,m,w[n+14],C,3275163606),m=c(m,v,p,h,w[n+3],x,4107603335),h=c(h,m,v,p,w[n+8],I,1163531501),p=c(p,h,m,v,w[n+13],T,2850285829),v=c(v,p,h,m,w[n+2],C,4243563512),m=c(m,v,p,h,w[n+7],x,1735328473),h=c(h,m,v,p,w[n+12],I,2368359562),p=u(p,h,m,v,w[n+5],L,4294588738),v=u(v,p,h,m,w[n+8],A,2272392833),m=u(m,v,p,h,w[n+11],B,1839030562),h=u(h,m,v,p,w[n+14],_,4259657740),p=u(p,h,m,v,w[n+1],L,2763975236),v=u(v,p,h,m,w[n+4],A,1272893353),m=u(m,v,p,h,w[n+7],B,4139469664),h=u(h,m,v,p,w[n+10],_,3200236656),p=u(p,h,m,v,w[n+13],L,681279174),v=u(v,p,h,m,w[n+0],A,3936430074),m=u(m,v,p,h,w[n+3],B,3572445317),h=u(h,m,v,p,w[n+6],_,76029189),p=u(p,h,m,v,w[n+9],L,3654602809),v=u(v,p,h,m,w[n+12],A,3873151461),m=u(m,v,p,h,w[n+15],B,530742520),h=u(h,m,v,p,w[n+2],_,3299628645),p=d(p,h,m,v,w[n+0],j,4096336452),v=d(v,p,h,m,w[n+7],O,1126891415),m=d(m,v,p,h,w[n+14],E,2878612391),h=d(h,m,v,p,w[n+5],q,4237533241),p=d(p,h,m,v,w[n+12],j,1700485571),v=d(v,p,h,m,w[n+3],O,2399980690),m=d(m,v,p,h,w[n+10],E,4293915773),h=d(h,m,v,p,w[n+1],q,2240044497),p=d(p,h,m,v,w[n+8],j,1873313359),v=d(v,p,h,m,w[n+15],O,4264355552),m=d(m,v,p,h,w[n+6],E,2734768916),h=d(h,m,v,p,w[n+13],q,1309151649),p=d(p,h,m,v,w[n+4],j,4149444226),v=d(v,p,h,m,w[n+11],O,3174756917),m=d(m,v,p,h,w[n+2],E,718787259),h=d(h,m,v,p,w[n+9],q,3951481745),p=t(p,o),h=t(h,i),m=t(m,r),v=t(v,a);var F=g(p)+g(h)+g(m)+g(v);return F.toUpperCase()}})}(jQuery),{requestCount:n,requestTime:t,cache:o,getQueryString:i,getHashStr:r,library:a,showTip:s,showLoading:c,hideLoading:u,showCover:d,hideCover:l,strlen:g,transferString:f,isOpenInWechat:p,showSwipeBox:h,imgError:m,goTop:v,ticketNoStr:w,loaderImg:k,require:b,ajaxRequest:S,request:y,checkLogin:T,authorize:C,checkGeoLoc:x,randomString:I,isPhone:L,confirm:A,alert:B,_loadAES:_,aesEncrypt:j,aesDecrypt:O,addBack:E,addMenu:q}});